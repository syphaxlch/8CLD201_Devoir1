{
  "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",  // Spécifie le schéma du modèle ARM pour la validation.
  "contentVersion": "1.0.0.0",  // Version du modèle ARM.
  "parameters": {  // Définition des paramètres du modèle, utilisés pour personnaliser le déploiement.
    "location": {  // Paramètre pour la localisation du déploiement.
      "type": "string"
    },
    "osDiskType": {  // Paramètre pour spécifier le type de disque OS (par ex., Premium_LRS).
      "type": "string"
    },
    "virtualNetworkId": {  // Paramètre pour l'ID du réseau virtuel.
      "type": "string"
    },
    "virtualNetworkName": {  // Paramètre pour le nom du réseau virtuel.
      "type": "string"
    },
    "networkSecurityGroups": {  // Paramètre pour définir les groupes de sécurité réseau à appliquer.
      "type": "array"
    },
    "networkInterfaceConfigurations": {  // Paramètre pour configurer les interfaces réseau des VM.
      "type": "array"
    },
    "backendPoolName": {  // Nom du pool de serveurs backend pour le Load Balancer.
      "type": "string"
    },
    "loadBalancerName": {  // Nom du Load Balancer à déployer.
      "type": "string"
    },
    "loadbalancingRuleFrontEndPort": {  // Port frontend du Load Balancer.
      "type": "int"
    },
    "loadbalancingRuleBackendEndPort": {  // Port backend du Load Balancer.
      "type": "int"
    },
    "loadbalancingRuleProtocol": {  // Protocole utilisé par le Load Balancer (TCP, UDP, etc.).
      "type": "string"
    },
    "InboundNATRuleFrontEndPortRangeStart": {  // Plage de ports frontend pour la règle NAT inbound.
      "type": "int"
    },
    "vmName": {  // Nom de la machine virtuelle à déployer.
      "type": "string"
    },
    "virtualMachineScaleSetName": {  // Nom du jeu d'échelles de machines virtuelles (VMSS).
      "type": "string"
    },
    "instanceCount": {  // Nombre d'instances de machines virtuelles dans le scale set.
      "type": "string"
    },
    "instanceSize": {  // Taille de chaque instance virtuelle (par ex., Standard_D2_v2).
      "type": "string"
    },
    "zone": {  // Zones de disponibilité pour le déploiement.
      "type": "array"
    },
    "zoneBalance": {  // Politique d'équilibrage des zones.
      "type": "string"
    },
    "platformFaultDomainCount": {  // Nombre de domaines de défaillance de la plateforme pour le Scale Set.
      "type": "string"
    },
    "scaleInPolicy": {  // Politique de réduction de l'échelle (scaling down).
      "type": "object"
    },
    "upgradePolicy": {  // Politique de mise à jour des instances du Scale Set.
      "type": "string"
    },
    "hibernationEnabled": {  // Indicateur d'activation de l'hibernation pour les instances.
      "type": "bool"
    },
    "adminUsername": {  // Nom d'utilisateur administrateur pour les VM.
      "type": "string"
    },
    "adminPassword": {  // Mot de passe administrateur (sécurisé) pour les VM.
      "type": "secureString"
    },
    "customData": {  // Données personnalisées (souvent utilisées pour la configuration initiale des VM).
      "type": "secureString"
    },
    "securityType": {  // Type de sécurité pour les machines virtuelles.
      "type": "string"
    },
    "secureBoot": {  // Activation du démarrage sécurisé pour les VM.
      "type": "bool"
    },
    "vTPM": {  // Activation de la puce TPM virtuelle pour les machines virtuelles.
      "type": "bool"
    },
    "vnetLocation": {  // Localisation du réseau virtuel dans Azure.
      "type": "string",
      "metadata": {
        "description": "Azure region for the deployment, resource group and resources."
      },
      "defaultValue": "eastus"  // Valeur par défaut : région "eastus".
    },
    "vnetExtendedLocation": {  // Emplacement étendu pour le réseau virtuel (optionnel).
      "type": "object",
      "defaultValue": {}
    },
    "vnetVirtualNetworkName": {  // Nom du réseau virtuel à déployer.
      "type": "string",
      "defaultValue": "vnet-eastus",
      "metadata": {
        "description": "Name of the virtual network resource."
      }
    },
    "vnetTagsByResource": {  // Balises optionnelles pour les ressources du réseau virtuel.
      "type": "object",
      "defaultValue": {},
      "metadata": {
        "description": "Optional tags for the resources."
      }
    },
    "vnetProperties": {  // Propriétés du réseau virtuel à déployer (subnets, address space, etc.).
      "type": "object",
      "defaultValue": {
        "subnets": [
          {
            "name": "snet-eastus-1",
            "properties": {
              "addressPrefixes": [
                "172.16.0.0/24"  // Plage d'adresses du sous-réseau.
              ]
            }
          }
        ],
        "addressSpace": {
          "addressPrefixes": [
            "172.16.0.0/16"  // Plage d'adresses du réseau virtuel.
          ]
        }
      }
    },
    "vnetNatGatewaysWithNewPublicIpAddress": {  // Liste des NAT Gateways à créer avec une nouvelle adresse IP publique.
      "type": "array",
      "defaultValue": []
    },
    "vnetNatGatewaysWithoutNewPublicIpAddress": {  // Liste des NAT Gateways sans nouvelle adresse IP publique.
      "type": "array",
      "defaultValue": []
    },
    "vnetNatGatewayPublicIpAddressesNewNames": {  // Liste des nouvelles adresses IP publiques pour les NAT Gateways.
      "type": "array",
      "metadata": {
        "description": "Array of public ip addresses for NAT Gateways."
      },
      "defaultValue": []
    },
    "vnetNetworkSecurityGroupsNew": {  // Liste des groupes de sécurité réseau à appliquer aux sous-réseaux.
      "type": "array",
      "metadata": {
        "description": "Array of NAT Gateway objects for subnets."
      },
      "defaultValue": []
    },
    "vnetResourceGroupName": {  // Nom du groupe de ressources du réseau virtuel.
      "type": "string",
      "defaultValue": "RG1"
    },
    "vnetDeploymentName": {  // Nom de la ressource de déploiement du réseau virtuel.
      "type": "string",
      "defaultValue": "network-interface-associated-virtual-network-20241107201134"
    }
  },
  "variables": {  // Variables utilisées pour simplifier la gestion des ressources et de leur version.
    "storageApiVersion": "2021-01-01",
    "networkApiVersion": "2020-11-01",
    "virtualMachineScaleSetApiVersion": "2024-07-01",
    "namingInfix": "[toLower(substring(concat(parameters('virtualMachineScaleSetName'), uniqueString(resourceGroup().id)), 0, 9))]",  // Génère un préfixe unique pour les noms de ressources.
    "autoScaleResourceName": "[concat(substring(parameters('virtualMachineScaleSetName'), 0, min(length(parameters('virtualMachineScaleSetName')), 55)), 'autoscale')]",  // Nom de la ressource d'autoscaling.
    "vmssId": "[resourceId('Microsoft.Compute/virtualMachineScaleSets', parameters('virtualMachineScaleSetName'))]",  // ID du Scale Set de VM.
    "standardSku": {  // SKU standard pour les ressources réseau.
      "name": "Standard"
    },
    "vnetStaticAllocation": {
      "publicIPAllocationMethod": "Static"  // Méthode d'allocation IP statique pour les ressources NAT Gateway.
    },
    "vnetPremiumTier": {
      "tier": "Premium"  // Utilisation du niveau Premium pour les ressources IP publiques.
    },
    "vnetPublicIpAddressesTags": "[if(contains(parameters('vnetTagsByResource'), 'Microsoft.Network/publicIpAddresses'), parameters('vnetTagsByResource')['Microsoft.Network/publicIpAddresses'], json('{}'))]",  // Récupère les balises des adresses IP publiques si présentes.
    "vnetNatGatewayTags": "[if(contains(parameters('vnetTagsByResource'), 'Microsoft.Network/natGateways'), parameters('vnetTagsByResource')['Microsoft.Network/natGateways'], json('{}'))]"  // Récupère les balises des NAT Gateways si présentes.
 
